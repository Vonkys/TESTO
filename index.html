<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LOGITREX</title>
  
  <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB1348RAmjUOKAldQ_zd5_cgfjKuZA0Qu8",
    authDomain: "logitrex-648a1.firebaseapp.com",
    databaseURL: "https://logitrex-648a1-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "logitrex-648a1",
    storageBucket: "logitrex-648a1.appspot.com",
    messagingSenderId: "586839571743",
    appId: "1:586839571743:web:8f82c164a6cf689e7c042a",
    measurementId: "G-GTPC1B8BXC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  window.firebaseApp = app;
  window.firebaseDB = db;
  window.firebaseRefs = { ref, get, set };

</script>
    
    <script>
  let playerId = localStorage.getItem("playerId");
  if (!playerId) {
    playerId = "player_" + Math.random().toString(36).substring(2);
    localStorage.setItem("playerId", playerId);
  }
</script>
    
    <style>
    /* ... stejn√Ω styl jako p≈ôedt√≠m ... */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f1e6;
    }
    header {
      background-color: #333;
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav a {
      color: white;
      text-decoration: none;
      margin: 0 10px;
      padding: 5px 10px;
      border-radius: 5px;
    }
    nav a:hover {
      background-color: #555;
    }
    .resources {
  display: flex;                /* Flexbox pro zarovn√°n√≠ */
  justify-content: space-between; /* Rozprost≈ôe polo≈æky rovnomƒõrnƒõ na ≈ô√°dek */
  background-color: #e8e4d8;
  padding: 10px;
  margin-top: 5px;
  font-weight: bold;
}
#tokens {
  color: #d4af37; /* Zlat√° barva pro tokeny */
}

    .circle {
      position: relative;
      width: 600px;
      height: 600px;
      border-radius: 50%;
      background-color: #f2e6c2;
      margin: 20px auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .field-icon {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 30px;
      cursor: pointer;
      border: 2px solid #aaa;
      user-select: none;
    }
    .field-level {
      font-size: 12px;
      margin-top: 2px;
      font-weight: bold;
    }
    .field-timer {
      font-size: 10px;
      color: red;
      margin-top: 2px;
      font-family: monospace;
      height: 14px;
    }
    .center-button {
  width: 80px;
  height: 80px;
  background-color: #d4c19c;
  border-radius: 50%;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  display: flex; /* P≈ôid√°no! */
  justify-content: center; /* Horizont√°lnƒõ na st≈ôed */
  align-items: center;     /* Vertik√°lnƒõ na st≈ôed */
  text-align: center;
  user-select: none;
  text-decoration: none;
  color: black;
}

    .production-box {
      position: absolute;
      top: 50%;
      left: calc(100% + 40px);
      transform: translateY(-50%);
      background-color: #eae3cd;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      font-size: 14px;
      min-width: 170px;
    }
    .upgrade-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff9e6;
      border: 2px solid #c4a76d;
      padding: 20px;
      border-radius: 15px;
      z-index: 10;
      display: none;
      min-width: 280px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .upgrade-popup h3 {
      margin-top: 0;
    }
    .upgrade-popup button {
      margin-top: 10px;
      padding: 5px 15px;
      font-weight: bold;
      background-color: #c4a76d;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
    .close-button {
      position: absolute;
      top: 5px;
      right: 10px;
      background: none;
      border: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      color: #333;
    }
    
   .logo-box {
  position: absolute;
  left: 0px;
  top: 150px;
}

.logo-box img {
  height: 100px;
  width: auto;
  border-radius: 10px;
}

    
    #clearStorageBtn {
      margin: 10px auto;
      display: block;
      padding: 8px 20px;
      font-weight: bold;
      background-color: #c44;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #clearStorageBtn:hover {
      background-color: #a33;
    }
    /* Nov√© styly pro upgrade list */
    #upgradeList {
      max-width: 600px;
      margin: 20px auto;
      background: #fff9e6;
      border: 2px solid #c4a76d;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      font-family: Arial, sans-serif;
    }
    #upgradeList h3 {
      margin-top: 0;
      text-align: center;
    }
    #upgradeList ul {
      list-style: none;
      padding: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    #upgradeList li {
      padding: 5px 0;
      border-bottom: 1px solid #c4a76d;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
    }
    #addTokensBtn {
  background-color: #4caf50;
  color: white;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  font-size: 16px;
  margin-left: 20px;
}

#addTokensBtn:hover {
  background-color: #45a049;
}

    #tokensContainer {
      max-width: 600px;
      margin: 10px auto 40px;
      background: #fff9e6;
      border: 2px solid #c4a76d;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
      font-weight: bold;
      font-size: 16px;
    }
    #speedUpBtn {
      margin-top: 10px;
      padding: 8px 20px;
      background-color: #c4a76d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
   
     .prod-bold {
    font-weight: bold;
    font-size: 16px;
  ¬†}

    #speedUpBtn:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    #speedUpBtn:hover:not(:disabled) {
      background-color: #a78e4a;
    }
    #speedUpBtn {
  display: block;
  margin: 20px auto;
  padding: 10px 20px;
  background-color: #d4af37;
  border: none;
  color: white;
  font-size: 16px;
  cursor: pointer;
  text-align: center;
}

#speedUpBtn:hover {
  background-color: #c69c6d;
}

  </style>
</head>
<body>
  <header>
    <nav>
      <a href="#" onclick="event.preventDefault();">Pole</a>
      <a href="buildings.html">Budovy</a>
      <a href="#">Statistiky</a>
      <a href="#">Zpr√°vy</a>
    </nav>
  </header>

<div style="position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: gray;">
  Tv√© ID: <span id="playerIdDisplay"></span>
</div>

  <div class="resources">
  <div style="color:brown;">üå≤ D≈ôevo: <span id="wood">0</span> / <span id="maxWood">0</span></div>
  <div style="color:red;">üß± Hl√≠na: <span id="clay">0</span> / <span id="maxClay">0</span></div>
  <div style="color:blue;">‚õè ≈Ωelezo: <span id="iron">0</span> / <span id="maxIron">0</span></div>
  <div style="color:goldenrod;">üåæ Obil√≠: <span id="grain">0</span> / <span id="maxGrain">0</span></div>
  <div style="color:purple;">üíé Tokeny: <span id="tokens">0</span></div>
  <button id="addTokensBtn">P≈ôidat 500 zlat√Ωch</button>
</div>
      
  <div class="logo-box">
  <img src="logo.png" alt="LOGITREX Logo">
</div>

  
  <div class="circle" id="fieldCircle">
    <a href="buildings.html" class="center-button" title="Budovy">üèõÔ∏è</a>
      <div class="production-box" id="productionBox">
      <div class="prod-bold">üå≤ D≈ôevo/h: <span id="woodRate">0</span></div>
      <div class="prod-bold">üß± Hl√≠na/h: <span id="clayRate">0</span></div>
      <div class="prod-bold">‚õè ≈Ωelezo/h: <span id="ironRate">0</span></div>
      <div class="prod-bold">üåæ Obil√≠/h: <span id="grainRate">0</span></div>
    </div>
  </div>

  <div id="upgradeList">
    <h3>Prob√≠haj√≠c√≠ vylep≈°en√≠ pol√≠</h3>
    <ul id="upgradesUl">
      <!-- Dynamicky vyplnƒõno -->
    </ul>
  </div>

 <button id="speedUpBtn" onclick="speedUpUpgrades()">Urychlit v≈°echny upgrady za 2 tokeny</button>

  <div class="upgrade-popup" id="upgradePopup">
    <button class="close-button" onclick="closeUpgradePopup()">√ó</button>
    <h3>Vylep≈°it pole (√∫rove≈à <span id="currentLevel">1</span>)</h3>
    <p>Stoj√≠:</p>
    <ul style="font-weight: bold;">
  <li>üå≤ D≈ôevo: <span id="costWood">0</span></li>
  <li>üß± Hl√≠na: <span id="costClay">0</span></li>
  <li>‚õè ≈Ωelezo: <span id="costIron">0</span></li>
  <li>üåæ Obil√≠: <span id="costGrain">0</span></li>
    </ul>
    <p id="upgradeStatus" style="color:red; font-weight:bold; margin-top:10px;"></p>
    <button id="upgradeButton" onclick="startUpgrade()">Vylep≈°it</button>
  </div>

  <script>
    
    playerId = localStorage.getItem("playerId");

if (!playerId) {
  const wantsExisting = confirm("Chce≈° zadat existuj√≠c√≠ hr√°ƒçsk√© ID?");
  if (wantsExisting) {
    const enteredId = prompt("Zadej ID hr√°ƒçe:");
    if (enteredId && enteredId.trim() !== "") {
      playerId = enteredId.trim();
    } else {
      alert("Neplatn√© ID ‚Äì bude vytvo≈ôen nov√Ω √∫ƒçet.");
      playerId = "player_" + Math.random().toString(36).substring(2);
    }
  } else {
    playerId = "player_" + Math.random().toString(36).substring(2);
  }
  localStorage.setItem("playerId", playerId);
}
    
    const production = { wood: 0, clay: 0, iron: 0, grain: 0 };
    const productionByLevel = {
  1: 50,
  2: 80,
  3: 120,
  4: 200,
  5: 300,
  6: 500,
  7: 800,
  8: 1000,
  9: 1200,
  10: 1600
};
    let resources = { wood: 3000, clay: 3000, iron: 3000, grain: 3000 };
    let floatResources = { ...resources };
    let fields = [];
    const types = ["üå≤", "üß±", "‚õèÔ∏è", "üåæ"];
    const fieldTypes = ["wood", "clay", "iron", "grain"];

    let fieldsData = null;
    let currentUpgradeIndex = null;
    let tokens = 300;
    let upgradedThisTick = new Set();
    let buildingData = JSON.parse(localStorage.getItem("buildingData")) || {};


    function formatTime(ms) {
      if (ms <= 0) return "";
      const totalSec = Math.ceil(ms / 1000);
      const min = Math.floor(totalSec / 60);
      const sec = totalSec % 60;
      return `${min}:${sec.toString().padStart(2, "0")}`;
    }

    function upgradeDuration(currentLevel) {
      const targetLevel = currentLevel + 1;
      if (targetLevel <= 1) return 0;
      if (targetLevel >= 10) return 2 * 60 * 60 * 1000;
      return 60 * 1000 + ((targetLevel - 2) / (10 - 2)) * (2 * 60 * 60 * 1000 - 60 * 1000);
    }

   function saveGame() {
  const { ref, set } = window.firebaseRefs;
  const playerId = localStorage.getItem("playerId");
  const playerRef = ref(window.firebaseDB, "players/" + playerId);

  const data = {
    resources: floatResources,
    fields: fieldsData,
    buildings: buildingData,
    tokens: tokens,
    lastVisit: Date.now()
  };

  set(playerRef, data)
    .then(() => {
      console.log("‚úÖ Data ulo≈æena na Firebase.");
    })
    .catch((error) => {
      console.error("‚ùå Chyba p≈ôi ukl√°d√°n√≠:", error);
    });
}

 function loadGame() {
  const rRes = localStorage.getItem("resources");
  const rFields = localStorage.getItem("fields");

  if (rRes) {
    floatResources = JSON.parse(rRes);
  }

  if (rFields) {
    fieldsData = JSON.parse(rFields);
  } else {
    fieldsData = Array(20)
      .fill(null)
      .map((_, i) => {
        let type;
        if (i < 4) type = "wood";
        else if (i < 8) type = "clay";
        else if (i < 12) type = "iron";
        else type = "grain";
        return { type, level: 1, upgradeEndTime: null };
      });
  }

  resources = {
    wood: Math.floor(floatResources.wood),
    clay: Math.floor(floatResources.clay),
    iron: Math.floor(floatResources.iron),
    grain: Math.floor(floatResources.grain),
  };

  updateResources();
  updateProduction();
  updateFieldIcons();
  updateUpgradeList();
}

function generateDefaultFields() {
  return Array(20).fill(null).map((_, i) => {
    let type;
    if (i < 4) type = "wood";
    else if (i < 8) type = "clay";
    else if (i < 12) type = "iron";
    else type = "grain";
    return { type, level: 1, upgradeEndTime: null };
  });
}


    function createFields() {
      const fieldCircle = document.getElementById("fieldCircle");
      const total = 20;
      const radius = 250;
      for (let i = 0; i < total; i++) {
        const icon = document.createElement("div");
        icon.className = "field-icon";
        const angle = (360 / total) * i;
        const radians = (angle * Math.PI) / 180;
        const x = Math.cos(radians) * radius;
        const y = Math.sin(radians) * radius;
        icon.style.left = `calc(50% + ${x}px - 30px)`;
        icon.style.top = `calc(50% + ${y}px - 30px)`;
        icon.dataset.index = i;

        icon.onclick = () => showUpgradePopup(fields[i]);
        fieldCircle.appendChild(icon);
        fields.push(icon);
      }
    }

    function updateFieldIcons() {
  for (let i = 0; i < fields.length; i++) {
    const field = fields[i];
    const data = fieldsData[i];

    // Ochrana proti chybƒõ
    if (!data || !data.type) {
      field.textContent = "?";
      continue;
    }

    
    const typeIndex = fieldTypes.indexOf(data.type);
    if (typeIndex === -1) {
      field.textContent = "?";
      continue;
    }
    
    field.textContent = types[typeIndex] || "?";

    let lvlDiv = field.querySelector(".field-level");
    if (!lvlDiv) {
      lvlDiv = document.createElement("div");
      lvlDiv.className = "field-level";
      field.appendChild(lvlDiv);
    }
    lvlDiv.textContent = "Lvl " + data.level;

    let timerDiv = field.querySelector(".field-timer");
    if (!timerDiv) {
      timerDiv = document.createElement("div");
      timerDiv.className = "field-timer";
      field.appendChild(timerDiv);
    }

    if (data.upgradeEndTime && Date.now() < data.upgradeEndTime) {
      const remaining = data.upgradeEndTime - Date.now();
      timerDiv.textContent = formatTime(remaining);
      field.style.opacity = "0.6";
    } else {
      timerDiv.textContent = "";
      field.style.opacity = "1";
    }
  }
}

    function calculateCost(level, type) {
  const cost = { wood: 0, clay: 0, iron: 0, grain: 0 };
  switch (type) {
    case "wood":
      cost.wood = 40 * level;
      cost.clay = 100 * level;
      cost.iron = 110 * level;
      cost.grain = 30 * level;
      break;
    case "clay":
      cost.wood = 100 * level;
      cost.clay = 40 * level;
      cost.iron = 110 * level;
      cost.grain = 30 * level;
      break;
    case "iron":
      cost.wood = 100 * level;
      cost.clay = 110 * level;
      cost.iron = 40 * level;
      cost.grain = 30 * level;
      break;
    case "grain":
      cost.wood = 100 * level;
      cost.clay = 100 * level;
      cost.iron = 100 * level;
      cost.grain = 10 * level;
      break;
  }
  return cost;
}
       

    function showUpgradePopup(field) {
      const i = parseInt(field.dataset.index);
      currentUpgradeIndex = i;
      const data = fieldsData[i];
      const level = data.level;
      const type = data.type;
      const cost = calculateCost(level, type);

      document.getElementById("currentLevel").innerText = level;
      document.getElementById("costWood").innerText = cost.wood;
      document.getElementById("costClay").innerText = cost.clay;
      document.getElementById("costIron").innerText = cost.iron;
      document.getElementById("costGrain").innerText = cost.grain;

      updateUpgradePopupTimer();

      const popup = document.getElementById("upgradePopup");
      popup.style.display = "block";
    }

    function updateUpgradePopupTimer() {
      if (currentUpgradeIndex === null) return;

      const data = fieldsData[currentUpgradeIndex];
      const upgradeBtn = document.getElementById("upgradeButton");
      const statusP = document.getElementById("upgradeStatus");

      if (data.upgradeEndTime && Date.now() < data.upgradeEndTime) {
        upgradeBtn.disabled = true;
        upgradeBtn.textContent = "Vylep≈°en√≠ prob√≠h√°...";
        const remaining = data.upgradeEndTime - Date.now();
        statusP.textContent = `Zb√Ωv√°: ${formatTime(remaining)}`;
      } else {
        upgradeBtn.disabled = false;
        upgradeBtn.textContent = "Vylep≈°it";
        statusP.textContent = "";
      }
    }

    function closeUpgradePopup() {
      document.getElementById("upgradePopup").style.display = "none";
      currentUpgradeIndex = null;
    }
    
    function getBuildSpeedModifier() {
  const mainLevel = buildingData["main"]?.level || 0;
  const bonus = Math.min(mainLevel * 0.025, 0.5); // 2.5 % za level, max 50 %
  return 1 - bonus;
}
    // ---- Definice r≈Østu kapacity podle budov ----
const storageGrowth = {
  warehouse: { wood: 800, clay: 800, iron: 800 },
  granary: { grain: 1200 }
};
const capacityByLevel = {
  warehouse: [4000, 6000, 10000, 16000, 23000, 31000, 45000, 61000, 70000, 85000, 100000],
  granary:   [4000, 6000, 10000, 16000, 23000, 31000, 45000, 61000, 70000, 85000, 100000]
};
// ---- V√Ωpoƒçet maxim√°ln√≠ kapacity skladu a s√Ωpky podle √∫rovnƒõ ----
function getMaxStorage() {
  const warehouseLvl = buildingData["warehouse"]?.level || 0;
  const granaryLvl = buildingData["granary"]?.level || 0;

  return {
    wood: capacityByLevel.warehouse[warehouseLvl] || 4000,
    clay: capacityByLevel.warehouse[warehouseLvl] || 4000,
    iron: capacityByLevel.warehouse[warehouseLvl] || 4000,
    grain: capacityByLevel.granary[granaryLvl] || 4000
  };
}


    
    function startUpgrade() {
      if (currentUpgradeIndex === null) return;

      const data = fieldsData[currentUpgradeIndex];
      if (data.upgradeEndTime && Date.now() < data.upgradeEndTime) {
        alert("Toto pole u≈æ se vylep≈°uje!");
        return;
      }
      // Zjisti kolik pol√≠ se pr√°vƒõ vylep≈°uje
  const activeUpgrades = fieldsData.filter(f => f.upgradeEndTime && Date.now() < f.upgradeEndTime).length;
  if (activeUpgrades >= 3) {
    alert("M≈Ø≈æe≈° m√≠t pouze 3 souƒçasn√© upgrady pol√≠!");
    return;
  }
      const cost = calculateCost(data.level, data.type);

      if (
        floatResources.wood >= cost.wood &&
        floatResources.clay >= cost.clay &&
        floatResources.iron >= cost.iron &&
        floatResources.grain >= cost.grain
      ) {
        floatResources.wood -= cost.wood;
        floatResources.clay -= cost.clay;
        floatResources.iron -= cost.iron;
        floatResources.grain -= cost.grain;

        resources.wood = Math.floor(floatResources.wood);
        resources.clay = Math.floor(floatResources.clay);
        resources.iron = Math.floor(floatResources.iron);
        resources.grain = Math.floor(floatResources.grain);

        const duration = upgradeDuration(data.level) * getBuildSpeedModifier();
         data.upgradeEndTime = Date.now() + duration;

        updateResources();
        updateFieldIcons();
        saveGame();
        closeUpgradePopup();
      } else {
        alert("Nem√°≈° dostatek zdroj≈Ø pro vylep≈°en√≠.");
      }
    }

    function updateResources() {
      resources.wood = Math.floor(floatResources.wood);
      resources.clay = Math.floor(floatResources.clay);
      resources.iron = Math.floor(floatResources.iron);
      resources.grain = Math.floor(floatResources.grain);
      document.getElementById("wood").innerText = resources.wood;
      document.getElementById("clay").innerText = resources.clay;
      document.getElementById("iron").innerText = resources.iron;
      document.getElementById("grain").innerText = resources.grain;
    }
    function updateMaxStorageDisplay() {
  const max = getMaxStorage();
  document.getElementById("maxWood").innerText = max.wood;
  document.getElementById("maxClay").innerText = max.clay;
  document.getElementById("maxIron").innerText = max.iron;
  document.getElementById("maxGrain").innerText = max.grain;
}
    
    function updateProduction() {
      production.wood = 0;
      production.clay = 0;
      production.iron = 0;
      production.grain = 0;
      for (const data of fieldsData) {
        production[data.type] += productionByLevel[data.level] || 0;
      }
      document.getElementById("woodRate").innerText = production.wood;
      document.getElementById("clayRate").innerText = production.clay;
      document.getElementById("ironRate").innerText = production.iron;
      document.getElementById("grainRate").innerText = production.grain;
    }

    // Aktualizuje seznam prob√≠haj√≠c√≠ch upgrade≈Ø dole
    function updateUpgradeList() {
      const ul = document.getElementById("upgradesUl");
      ul.innerHTML = "";
      const now = Date.now();
      let anyUpgrades = false;
      for (let i = 0; i < fieldsData.length; i++) {
        const data = fieldsData[i];
        if (data.upgradeEndTime && data.upgradeEndTime > now) {
          anyUpgrades = true;
          const remaining = data.upgradeEndTime - now;
          const li = document.createElement("li");
          li.textContent = `Pole ${i + 1} (${data.type}) - lvl ${data.level} ‚Üí ${data.level + 1}, zb√Ωv√° ${formatTime(remaining)}`;
          ul.appendChild(li);
        }
      }
      if (!anyUpgrades) {
        const li = document.createElement("li");
        li.textContent = "≈Ω√°dn√° prob√≠haj√≠c√≠ vylep≈°en√≠.";
        ul.appendChild(li);
      }
    }

    // Aktualizuje zobrazen√≠ token≈Ø a stav tlaƒç√≠tka
    function updateTokensDisplay() {
  if (document.getElementById("tokens")) {
    document.getElementById("tokens").innerText = tokens;
  }
}

    // Urychl√≠ v≈°echny upgrady o polovinu ƒçasu za 2 token≈Ø
    function speedUpUpgrades() {
      if (tokens < 2) {
        alert("Nem√°≈° dostatek token≈Ø na urychlen√≠.");
        return;
      }
     
      const now = Date.now();
      let anyUpgraded = false;
      for (const data of fieldsData) {
        if (data.upgradeEndTime && data.upgradeEndTime > now) {
          const remaining = data.upgradeEndTime - now;
          data.upgradeEndTime = now + Math.floor(remaining / 2);
          anyUpgraded = true;
        }
    }
      if (anyUpgraded) {
        tokens -= 2;
        updateTokensDisplay();
        saveGame();
        updateUpgradeList();
        updateFieldIcons();
        alert("V≈°echny upgrady byly urychleny o polovinu ƒçasu.");
      } else {
        alert("≈Ω√°dn√© upgrady k urychlen√≠.");
      }
    }

    setInterval(() => {
  const max = getMaxStorage(); // ‚Üê novƒõ

  if (floatResources.wood < max.wood) {
    floatResources.wood += production.wood / 3600;
  }
  if (floatResources.clay < max.clay) {
    floatResources.clay += production.clay / 3600;
  }
  if (floatResources.iron < max.iron) {
    floatResources.iron += production.iron / 3600;
  }
  if (floatResources.grain < max.grain) {
    floatResources.grain += production.grain / 3600;
  }

  floatResources.wood = Math.min(floatResources.wood, max.wood);
  floatResources.clay = Math.min(floatResources.clay, max.clay);
  floatResources.iron = Math.min(floatResources.iron, max.iron);
  floatResources.grain = Math.min(floatResources.grain, max.grain);

  let changed = false;
  for (let i = 0; i < fieldsData.length; i++) {
    const data = fieldsData[i];
    if (
      data.upgradeEndTime &&
      Date.now() >= data.upgradeEndTime &&
      !upgradedThisTick.has(i)
    ) {
      data.level++;
      data.upgradeEndTime = null;
      upgradedThisTick.add(i);
      changed = true;
    }
  }

  if (changed) {
    updateProduction();
    updateFieldIcons();
    saveGame();
  }

  upgradedThisTick.clear();
  updateResources();
  updateMaxStorageDisplay();
  updateFieldIcons();
  updateUpgradePopupTimer();
  updateUpgradeList();
  saveGame();
}, 1000);


    loadGame();
    createFields();
    updateProduction();
    updateFieldIcons();
    updateResources();
    updateUpgradeList();
    updateTokensDisplay();
   updateMaxStorageDisplay();





// ‚¨á SEM PASTEJNI TVOU FUNKCI
window.addEventListener('DOMContentLoaded', function () {
  document.getElementById('addTokensBtn').addEventListener('click', function () {
    const enteredPassword = prompt("Zadej heslo pro p≈ôid√°n√≠ zlat√Ωch:");
    if (enteredPassword === '1387') {
      const additionalTokens = 500;
      tokens += additionalTokens;
      updateTokensDisplay();
      alert(`P≈ôid√°no ${additionalTokens} zlat√Ωch! M√°te ${tokens} token≈Ø.`);
    } else {
      alert("‚ùå ≈†patn√© heslo. Tokeny nebyly p≈ôid√°ny.");
    }
  });
});

updateTokensDisplay();
updateMaxStorageDisplay();

window.addEventListener("DOMContentLoaded", function () {
  const idElement = document.getElementById("playerIdDisplay");
  if (idElement && playerId) {
    idElement.textContent = playerId;
  }
});



 </script>
</body>
</html>
